<title>Partida</title>
<link rel="stylesheet" href="../public/css/partidaStyle.css">
<body>
<header class="header">
    <img src="/public/imagenes/Logo.png" alt="logo" class="logo">
    <form method="POST" action="/Preguntados/inicio/logout">
        <input class="logout-btn" type="submit" value="Cerrar sesión">
    </form>
</header>
<main class="container">
    <h1>Partida iniciada</h1>
    <p>Tu oponente es: <strong>{{nombreOponente}}</strong></p>
    <p>Preguntas respondidas: <strong>{{cantidadCorrectas}}</strong></p>
    <p id="cronometro"></p>
    <div id="barraTiempo">
        <div id="tiempo"> </div>
    </div>
    <script>
    
    
        /*const tiempoTotal = 15;  //aca podemos setear el tiempo por pregunta
        var tiempoRestante = tiempoTotal; */
        const tiempoTotal = 15;
        var tiempoRestante = tiempoTotal;
        var cronometroElemento = document.getElementById('cronometro');
        var relleno = document.getElementById('tiempo');
        let tiempo;

        fetch('/partida/inicioCronometroAPI')
            .then(res => res.json())
            .then(data => {
                console.log("Tiempo máximo:", data);

                tiempo=data.tiempoMaximoPorTurno;
                cronometroElemento.innerText = tiempo;

                // no me convence porque no usamos los tiempos desde el backend, es todo desde el front y lo pueden tocar desde inspeccionar
                const intervalo = setInterval(() => {
                    tiempo--;
                    cronometroElemento.innerText = tiempo;
                    if(tiempo <= 0){
                        clearInterval(intervalo);//corta el cronometro
                        console.log("llego al maximo");
                        fetch('/partida/terminarPartidaPorTiempoMaximo');
                    }

                    fetch('/partida/controlarTiempo')
                    .then(res => res.text())
                    .then(data => {
                        console.log("res:", data);
                    });

                    //efecto visual de la barra de tiempo
                    var porcentajeRestante = (tiempo / data.tiempoMaximoPorTurno) * 100;
                    relleno.style.width = porcentajeRestante + '%';

                 },1000)//cada un segundo
            });
    </script>
    <p>La pregunta es: <strong>{{pregunta}}</strong></p>
   <div id="pregunta-container">
    {{#Respuestas}}
        <a href="/partida/evaluarTurno?respuestaElegida={{id_respuesta}}&turno={{id_turno}}&idPregunta={{idPregunta}}" class="list-group-item link-card mb-3 rounded">
        <h5 class="mb-0">{{descripcion}}</h5>
        </a>
    {{/Respuestas}}
   </div>
</main>
</body>